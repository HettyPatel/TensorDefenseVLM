# Configuration for tensor decomposition defense experiments

# Random seed for reproducibility
random_seed: 42

# Results directory (will be appended with timestamp)
results_dir: "results"

# Maximum number of batches to process (set to null to process all)
max_batches: null

# Model configuration
model:
  type: "clip" # "clip" or "llava"
  name: "openai/clip-vit-base-patch32" # Model identifier

# Dataset configuration
dataset:
  name: "nlphuji/flickr30k" # Dataset identifier
  split: "test" # Dataset split
  max_samples: 1000 # Maximum number of samples to use
  batch_size: 32 # Batch size for dataloader
  num_workers: 4 # Number of worker processes for dataloader

# Attack configuration
attack:
  type: "pgd" # "pgd" or "fgsm"
  epsilon: 0.0156863 # 4/255 - Weaker attack
  steps: 2 # Number of attack steps (for PGD)
  step_size: 0.0078431 # 2/255 - Smaller step size
  random_start: true # Whether to use random initialization (for PGD)

# Defense configurations
defenses:
  # Lower alpha values for stronger defense effect
  - name: "CP Final Norm (R=64, alpha=0.25)"
    type: "targeted"
    method: "cp"
    rank: 64
    alpha: 0.25 # Lower alpha = more emphasis on decomposed representation
    target_layer: "final_norm"
    vision_layer_idx: -1

  # Earlier layer in the network
  - name: "CP Final Norm (R=64, alpha=0.5, Layer=-3)"
    type: "targeted"
    method: "cp"
    rank: 64
    alpha: 0.5
    target_layer: "final_norm"
    vision_layer_idx: -3 # Earlier layer

  # Very low rank to remove more perturbations
  - name: "CP Final Norm (R=16, alpha=0.5)"
    type: "targeted"
    method: "cp"
    rank: 16 # Lower rank = stronger filtering
    alpha: 0.5
    target_layer: "final_norm"
    vision_layer_idx: -1

  # Combination of low alpha and earlier layer
  - name: "CP Final Norm (R=32, alpha=0.3, Layer=-2)"
    type: "targeted"
    method: "cp"
    rank: 32
    alpha: 0.3
    target_layer: "final_norm"
    vision_layer_idx: -2

  # Very aggressive defense
  - name: "CP Final Norm (R=16, alpha=0.2)"
    type: "targeted"
    method: "cp"
    rank: 16
    alpha: 0.2 # Very low alpha = very little original representation
    target_layer: "final_norm"
    vision_layer_idx: -1

  # Target attention layer with stronger settings
  - name: "CP Attention (R=32, alpha=0.3)"
    type: "targeted"
    method: "cp"
    rank: 32
    alpha: 0.3
    target_layer: "attention"
    vision_layer_idx: -1

  # Multi-layer defense with stronger settings
  - name: "Multi-Layer Defense (3 Layers)"
    type: "multilayer"
    layer_configs:
      - method: "cp"
        rank: 32
        alpha: 0.4
        target_layer: "final_norm"
        vision_layer_idx: -1
      - method: "cp"
        rank: 32
        alpha: 0.4
        target_layer: "final_norm"
        vision_layer_idx: -2
      - method: "cp"
        rank: 32
        alpha: 0.4
        target_layer: "final_norm"
        vision_layer_idx: -3
